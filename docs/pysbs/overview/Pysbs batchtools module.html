

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PySbs batchtools module &mdash; Substance by Adobe - Substance Automation Toolkit - </title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/_static/custom_rtd.css" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Package’s metadata" href="metadata%20manipulation.html" />
    <link rel="prev" title="Dependency path storage method" href="Dependencies%20management.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            SAT PySBS
              <img src="../../_static/sb_toolkit_icon_noshadow_256.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started with the API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="overview.html">API overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Basic%20manipulation.html">Basic manipulation of a Substance</a></li>
<li class="toctree-l2"><a class="reference internal" href="Substance%20creation.html">Creation of a Substance from scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="Substances%20modification.html">Modification of Substances</a></li>
<li class="toctree-l2"><a class="reference internal" href="Dependencies%20management.html">Dependency path storage method</a></li>
<li class="toctree-l2"><a class="reference internal" href="Dependencies%20management.html#dependencies-management">Dependencies management</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">PySBS batchtools presentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#batchtool-s-outputhandlers">batchtool’s OutputHandlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#render-animation-sequence">render animation sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-only-option">command_only option</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-thumbnails">Generate thumbnails</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="metadata%20manipulation.html">Package metadata manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Spot%20Colors.html">SAT and Spot colors</a></li>
<li class="toctree-l2"><a class="reference internal" href="Thumbnail%20creation%20with%20SAT.html">Generate thumbnails</a></li>
<li class="toctree-l2"><a class="reference internal" href="Edit%20sbsar%20with%20SBSARManager.html">Edit sbsar with SBSARManager</a></li>
<li class="toctree-l2"><a class="reference internal" href="SAT%20demos.html">SAT demos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">API Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sat_commandlines/sat_commandlines.html">Command Line Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CHANGELOG.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SAT PySBS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="overview.html">API overview</a></li>
      <li class="breadcrumb-item active">PySbs batchtools module</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pysbs-batchtools-module">
<span id="ref-to-overview-batchtools"></span><h1>PySbs batchtools module<a class="headerlink" href="#pysbs-batchtools-module" title="Link to this heading"></a></h1>
<p>The PySbs batchtools module allows you to call the different command line tools like ordinary python commands.</p>
<p><a class="reference internal" href="../batchtools/batchtools.html#ref-to-batchtools-batchtools"><span class="std std-ref">batchtools module</span></a> batchtools api reference.</p>
<p>The batchtools module wraps subprocess.Popen and makes it possible to use different command options as native arguments
in python.
The common structure of a batchtool is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">toolName</span><span class="p">}</span><span class="n">_</span><span class="p">{</span><span class="n">toolCommand</span><span class="p">}(</span><span class="n">an_input_file</span><span class="p">,</span> <span class="n">bool_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">string_flag</span><span class="o">=</span><span class="s2">&quot;a value&quot;</span><span class="p">,</span> <span class="n">int_flag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">list_flag</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a value&quot;</span><span class="p">,</span> <span class="s2">&quot;other value&quot;</span><span class="p">],</span> <span class="o">...</span><span class="p">)</span>

<span class="c1"># I.E</span>
<span class="c1"># a batchtool commandline conversion:</span>
<span class="c1"># substance3d_baker AmbientOcclusion.Raytraced /a/path/to/a/mesh/foo_low.fbx --output_size 256,256 --high_scene_paths a/path/to/a/mesh/foo_hi.fbx --output_name baked_name</span>
<span class="c1"># PySBS version :</span>
<span class="n">proc</span> <span class="o">=</span> <span class="n">substance3d_baker_ambient_occlusion_raytraced</span><span class="p">(</span><span class="s2">&quot;/a/path/to/a/mesh/foo_low.fbx&quot;</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
                                            <span class="n">high_scene_paths</span><span class="o">=</span><span class="s2">&quot;/a/path/to/a/mesh/foo_hi.fbx&quot;</span><span class="p">,</span> <span class="n">output_name</span><span class="o">=</span><span class="s2">&quot;baked_name&quot;</span><span class="p">)</span>
<span class="n">proc</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c1"># wait the end of the process</span>
</pre></div>
</div>
<p>It is important to call <cite>.wait()</cite> on the returned process handle before using any output data from the command.</p>
<p><a class="reference internal" href="../pysbs_demos/demos_batchtools.html#ref-to-demo-batchtools"><span class="std std-ref">demos_batchtools module</span></a> Examples which demonstrates an automated pipeline using a mesh with udims.</p>
<section id="batchtool-s-outputhandlers">
<span id="ref-to-overview-batchtools-outputhandlers"></span><h2>batchtool’s OutputHandlers<a class="headerlink" href="#batchtool-s-outputhandlers" title="Link to this heading"></a></h2>
<p>For some batchtools it can be an advantage to retrieve information from the output of the process. As instance
<cite>batchtools.substance3d_baker_info</cite> output is very useful to retrieve mesh information like udims or color id but the process
management and the information parsing may become painful.
That’s why SAT introduced some OutputHandlers to handle this for you. An OutputHandler become the result of a batchtools
call instead of a Popen object.
The OutputHandler digests the process and its output to give an usable object depend of the batchtool.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># call a substance3d_baker_info with the kwarg output_handler=True to get an OutputHandler instead of Popen</span>
<span class="c1"># the OutputHandler will stop the interpreter during the batchtool process exactly like Popen.wait()</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">batchtools</span><span class="o">.</span><span class="n">substance3d_baker_info</span><span class="p">(</span><span class="s1">&#39;foo.fbx&#39;</span><span class="p">,</span> <span class="n">output_handler</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="c1"># &lt;pysbs.batchtools.output_handlers.Substance3dBakerInfoOutputHandler object at 0x7f8808fe1c50&gt;</span>
<span class="c1"># to get the result use get_results, an OutputHandler&#39;s common method that extracts the information from the raw output</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="c1"># [&lt;pysbs.batchtools.substance3d_baker_info_handlers.Substance3dBakerInfoMeshStruct object at 0x7f7757881c10&gt;, &lt;pysbs.batchtools.substance3d_baker_info_handlers.Substance3dBakerInfoMeshStruct object at 0x7f7757881e10&gt;]</span>
<span class="c1"># Substance3dBakerInfoOutputHandler.get_results() return a list of Substance3dBakerInfoMeshStruct. Follow the doc to get more details of Substance3dBakerInfoMeshStruct</span>
<span class="c1"># as much as possible each member type is converted in a python type.</span>
<span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="c1"># some examples of its different members</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices_number</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">uv</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">uvs</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">uv</span><span class="o">.</span><span class="n">udim_tiles</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">subpart</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">geom_subsets</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">subpart</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
<span class="c1"># it become easy to retrieve all the udims or uv tiles:</span>
<span class="n">all_udims</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">udim</span> <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">for</span> <span class="n">uv</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">uvs</span> <span class="k">for</span> <span class="n">udim</span> <span class="ow">in</span> <span class="n">uv</span><span class="o">.</span><span class="n">udim_tiles</span><span class="p">])</span>

<span class="c1"># an other OutputHandler common method is dump() to write the output in a stream IO (file)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;dumped_file.ext&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">out</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>More details on the different OutputHandlers and it’s associated objects :</p>
<p>SbsRenderOutputHandler <a class="reference internal" href="../batchtools/output_handlers.html#ref-to-output-handlers"><span class="std std-ref">output_handlers module</span></a></p>
<p>SbsRenderGraphStruct <a class="reference internal" href="../batchtools/sbsrender_render_handlers.html#ref-to-sbsrender-render-handlers"><span class="std std-ref">sbsrender_render_handlers module</span></a></p>
<p>Substance3dBakerInfoOutputHandler <a class="reference internal" href="../batchtools/output_handlers.html#ref-to-output-handlers"><span class="std std-ref">output_handlers module</span></a></p>
<p>Substance3dBakerInfoMeshStruct <a class="reference internal" href="../batchtools/substance3d_baker_info_handlers.html#ref-to-substance3d-baker-info-handlers"><span class="std std-ref">substance3d_baker_info_handlers module</span></a></p>
</section>
<section id="render-animation-sequence">
<span id="ref-to-render-animate"></span><h2>render animation sequence<a class="headerlink" href="#render-animation-sequence" title="Link to this heading"></a></h2>
<p>As part of batchtools there is also <cite>sbsrender_render_animate</cite> function that allows you to render an image sequence.
<cite>sbsrender_render_animate</cite> renders an image sequence from an sbsar input using sbsrender.
It takes a start frame, an end frame and frames per second.
The sbsrender command line tool will be called once for each frame.</p>
<p>By default the $time parameter will be generated for each frame based on start, end and fps.
It is also possible to set pass in other sbsrender parameters globally.</p>
<p>To animate other parameters than $time <cite>sbsrender_render_animate</cite> has the <cite>animated_parameters</cite> argument .
This argument allow to pass a list of pairs of parameter names and functions taking frame and fps as parameters allowing
you to generate them over the image sequence.</p>
<p>More details about the different arguments on the api reference page <a class="reference internal" href="../batchtools/batchtools.html#ref-to-batchtools-batchtools"><span class="std std-ref">batchtools module</span></a></p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">batchtools</span><span class="o">.</span><span class="n">sbsrender_render_animate</span><span class="p">(</span><span class="s2">&quot;explosion.sbsar&quot;</span><span class="p">,</span>
                                    <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">end</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                    <span class="n">fps</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                                    <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{inputPath}</span><span class="s2">/animate_outputs&quot;</span><span class="p">,</span>
                                    <span class="n">output_name</span><span class="o">=</span><span class="s2">&quot;animate_frame_####&quot;</span><span class="p">,</span>
                                    <span class="n">input_graph_output</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
                                    <span class="n">animated_parameters</span><span class="o">=</span><span class="p">[</span>
                                        <span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">frame</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="n">frame</span> <span class="o">/</span> <span class="n">fps</span><span class="p">)],</span>
                                    <span class="n">multi_proc</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>This example renders 51 frames with a frame rate of 24. Note that the output_name value has a sequence padding
looking like <cite>###</cite> to specify the frame name in the filename.
In this example the <cite>animated_parameters</cite> is used to tweak the <cite>input</cite> parameter over time using a lambda function
taking the two arguments <cite>frame</cite> and <cite>fps</cite></p>
<a class="reference internal image-reference" href="../../_images/explosion.gif"><img alt="../../_images/explosion.gif" class="align-center" src="../../_images/explosion.gif" style="width: 384px;" />
</a>
</section>
<section id="command-only-option">
<span id="ref-to-overview-batchtools-commandonly"></span><h2>command_only option<a class="headerlink" href="#command-only-option" title="Link to this heading"></a></h2>
<p>Sometimes it could be great to only query the command line without execute it. As instance all the batchtools commands
could be “starting” on the user local machine but not executed instead all the commands are written in a file that will
be executed later by a renderfarm.
Simple example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pysbs</span><span class="w"> </span><span class="kn">import</span> <span class="n">batchtools</span>
<span class="n">cmds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batchtools</span><span class="o">.</span><span class="n">sbscooker</span><span class="p">(</span><span class="s2">&quot;foo.sbs&quot;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;/output&quot;</span><span class="p">,</span> <span class="n">command_only</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batchtools</span><span class="o">.</span><span class="n">sbsrender_render</span><span class="p">(</span><span class="s2">&quot;/output/foo.sbsar&quot;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;/output&quot;</span><span class="p">,</span> <span class="n">command_only</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/output/batchcommands.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmds</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="generate-thumbnails">
<h2>Generate thumbnails<a class="headerlink" href="#generate-thumbnails" title="Link to this heading"></a></h2>
<p>Generate thumbnails with SAT <a class="reference internal" href="Thumbnail%20creation%20with%20SAT.html#ref-to-overview-thumbnail"><span class="std std-ref">Thumbnail creation with SAT</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Dependencies%20management.html" class="btn btn-neutral float-left" title="Dependency path storage method" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="metadata%20manipulation.html" class="btn btn-neutral float-right" title="Package’s metadata" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Adobe.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>